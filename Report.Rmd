---
output:
  pdf_document: default
  word_document: default
---

# UNDERSTANDING DATA AND ITS ENVIRONMENT: REPORT ASSESSMENT

## 1. Introduction
Forecasting or making predictions of sales are fundamental and very challenging for retailers around the world (reference needed). 

This report explains the approach taken to forecast sales for a nationwide retailer in the U.S based on historical sales data for the departments of 45 stores. 

The consideration of the effects of promotional activities is an additional difficulty in the analysis given the fact that part of the promotion related data is absent from historical records. 

All task has been carried out using R. The report is reproducible based on code available at https://github.com/eugenividal/Understanding-data-report.

The whole process is described in the sections below.


## 2. Data description

The first stage before describing the data is to load it into the R environment. To to that, we will use the tidyverse package and load it with the `library()`function:


```{r, message=FALSE}
library(tidyverse)
# load data
source("code/load-data.R")
```


We can check that these files have been loaded with the following command:

```{r}
ls()
```

Four data sets have been provided about the company. These data sets have information about the stores, features... Each of the data sets and its features are explained below:

•	stores.csv

- Store: the anonymised store number
- Type: store type, A: supercentre, B: superstore, C: supermarket
- Size : store size (in square feet)

•	features.csv

- Store: the anonymised store number
- Date:	the week with the dated Friday
- Temperature: average temperature in the region
- Fuel_Price: cost of fuel in the region
- Promotions:	anonymised data related to promotions, mainly price reductions that the retailer is running. Promotion data is only available after Nov. 2011, and is not available for all stores all the time. Any missing value is marked with an NA.
- CPI: the consumer price index
- Unemployment: the unemployment rate
- IsHoliday: whether the week is a special holiday week

•	train.csv

- Store: the anonymised store number
- Department: the anonymised department number
- Date: the week with the dated Friday
- Weekly_Sales: sales for the given department in the given store
- IsHoliday: whether the week is a special holiday week

•	test.csv

This file is identical to train.csv, except you need to predict the weekly sales for each triplet of store, department, and date from 02/11/2012 to 26/07/2013.

To describe the data we will draw a histogram.

```{r, out.width="50%"}
b = seq(from = 0, to = 300000, by = 50000)
hist(stores$`Size (sq ft)`, main = "", xlab = "Store size (sqft)", breaks = b)
```

## 3. Data joining

Data sets are combined together into a unified view in order to facilitate the tasks of pre-processing and identifying the key factors.

No difficulties of Data Integration were found.

The three data sets (stores, train and features) are linked in this order using the 'store' variable as ID.

```{r}
# join store-level data onto training dataset (so we know size)
train_joined = inner_join(train, y = stores)
# would use rename() function to rename columns if needed (not needed)
train_joined = inner_join(train_joined, y = features)
```

The result is a data frame that contains 421570 observations.

## 4. Data re-processing

In this step we will carry out some techniques to arrange the data in a way that makes the analysis easier.

We will clean, prepare new data variables...

## 5. Identifying the key factors


## 6. Creating the predictive model

There are many packages and approach for forecasting.
We could use the `lm()` function to do a linear regression, for example.
Here we use the xgboost package

```{r}
# install.packages("xgboost")
m1 = lm(Weekly_Sales ~ IsHoliday + Fuel_Price, data = train_joined)
summary(m1)
# Plot regression line
plot(Weekly_Sales ~ IsHoliday + Fuel_Price, data = train_joined)
abline(m1, col="red")
# predicted_sales = predict(m1, train_joined)
# plot(train_joined$Weekly_Sales, predicted_sales)
```
Other option would be to use the ISLR package 

```{r}
# library("ISLR")
# install.packages("ISLR")
library("MASS")
library("ISLR")
m2 = lm(Weekly_Sales ~ Temperature, data = train_joined)
summary (m2)
# Plot regression line
plot(Weekly_Sales ~ Temperature, data = train_joined)
abline(m2, col="red")
```
 
 
 ```{r}
m3 = lm(Weekly_Sales ~ Dept + Store + Type + Promotion1 + Promotion2 + Promotion3 + Promotion4 + Promotion5 + CPI + Unemployment, data = train_joined)
summary (m3)
```
## 7. Conclusions