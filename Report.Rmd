---
output:
  word_document: default
  pdf_document: default
---

## UNDERSTANDING DATA AND ITS ENVIRONMENT: REPORT ASSESSMENT

## 1. Introduction

This report explains the approach taken to forecast sales across stores.
It is reproduble based on code available at https://github.com/eugenividal/Understanding-data-report

The task is to estimate sales for the departments of each store based on the historical training data.

The first stage is to load in the data. We will use the tidyverse package and load it with the `library()` function:


```{r, message=FALSE}
library(tidyverse)
# load data
source("code/load-data.R")
```

We can check that these files have been loaded into the R envionment with the following command:

```{r}
ls()
```

## 2. Reviewing and describing the data

The data is described on a histogram.

```{r, out.width="50%"}
b = seq(from = 0, to = 300000, by = 50000)
hist(stores$`Size (sq ft)`, main = "", xlab = "Store size (sqft)", breaks = b)
```

### 3. Joining the data

Data sets are combined together into a unified view in order to facilitate the tasks of pre-processing and identifying the key factors.

No difficulties of Data Integration were found.

The three data sets (stores, train and features) are linked in this order using the 'store' variable as ID.

```{r}
# join store-level data onto training dataset (so we know size)
train_joined = inner_join(train, y = stores)
# would use rename() function to rename columns if needed (not needed)
train_joined = inner_join(train_joined, y = features)
```

## 4. Pre-processing the data


## 5. Identifying the key factors


## 6. Creating the predictive model

There are many packages and approach for forecasting.
We could use the `lm()` function to do a linear regression, for example.
Here we use the xgboost package

```{r}
# install.packages("xgboost")
m1 = lm(Weekly_Sales ~ IsHoliday + Fuel_Price, data = train_joined)
summary(m1)
# Plot regression line
plot(Weekly_Sales ~ IsHoliday + Fuel_Price, data = train_joined)
abline(m1, col="red")
# predicted_sales = predict(m1, train_joined)
# plot(train_joined$Weekly_Sales, predicted_sales)
```
Other option would be to use the ISLR package 

```{r}
# library("ISLR")
# install.packages("ISLR")
library("MASS")
library("ISLR")
m2 = lm(Weekly_Sales ~ Temperature, data = train_joined)
summary (m2)
# Plot regression line
plot(Weekly_Sales ~ Temperature, data = train_joined)
abline(m2, col="red")
```
 
 
 ```{r}
m3 = lm(Weekly_Sales ~ Dept + Store + Type + Promotion1 + Promotion2 + Promotion3 + Promotion4 + Promotion5 + CPI + Unemployment, data = train_joined)
summary (m3)
```
 